--- a/Makefile
+++ b/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the drm device driver.  This driver provides support for the
 # Direct Rendering Infrastructure (DRI) in XFree86 4.1.0 and higher.
 
+include /boot/config-$(KVER)
+
 ccflags-y := -Iinclude/drm
 
 drm-y       :=	drm_auth.o drm_buffer.o drm_bufs.o drm_cache.o \
@@ -31,23 +33,29 @@ CFLAGS_drm_trace_points.o := -I$(src)
 obj-$(CONFIG_DRM)	+= drm.o
 obj-$(CONFIG_DRM_USB)   += drm_usb.o
 obj-$(CONFIG_DRM_TTM)	+= ttm/
-obj-$(CONFIG_DRM_TDFX)	+= tdfx/
-obj-$(CONFIG_DRM_R128)	+= r128/
+#obj-$(CONFIG_DRM_TDFX)	+= tdfx/
+#obj-$(CONFIG_DRM_R128)	+= r128/
 obj-$(CONFIG_DRM_RADEON)+= radeon/
-obj-$(CONFIG_DRM_MGA)	+= mga/
-obj-$(CONFIG_DRM_I810)	+= i810/
+#obj-$(CONFIG_DRM_MGA)	+= mga/
+#obj-$(CONFIG_DRM_I810)	+= i810/
 obj-$(CONFIG_DRM_I915)  += i915/
-obj-$(CONFIG_DRM_MGAG200) += mgag200/
-obj-$(CONFIG_DRM_CIRRUS_QEMU) += cirrus/
-obj-$(CONFIG_DRM_SIS)   += sis/
-obj-$(CONFIG_DRM_SAVAGE)+= savage/
-obj-$(CONFIG_DRM_VMWGFX)+= vmwgfx/
-obj-$(CONFIG_DRM_VIA)	+=via/
+#obj-$(CONFIG_DRM_MGAG200) += mgag200/
+#obj-$(CONFIG_DRM_CIRRUS_QEMU) += cirrus/
+#obj-$(CONFIG_DRM_SIS)   += sis/
+#obj-$(CONFIG_DRM_SAVAGE)+= savage/
+#obj-$(CONFIG_DRM_VMWGFX)+= vmwgfx/
+#obj-$(CONFIG_DRM_VIA)	+=via/
 obj-$(CONFIG_DRM_NOUVEAU) +=nouveau/
-obj-$(CONFIG_DRM_EXYNOS) +=exynos/
-obj-$(CONFIG_DRM_GMA500) += gma500/
-obj-$(CONFIG_DRM_UDL) += udl/
-obj-$(CONFIG_DRM_AST) += ast/
-obj-$(CONFIG_DRM_SHMOBILE) +=shmobile/
-obj-$(CONFIG_DRM_TEGRA) += tegra/
+#obj-$(CONFIG_DRM_EXYNOS) +=exynos/
+#obj-$(CONFIG_DRM_GMA500) += gma500/
+#obj-$(CONFIG_DRM_UDL) += udl/
+#obj-$(CONFIG_DRM_AST) += ast/
+#obj-$(CONFIG_DRM_SHMOBILE) +=shmobile/
+#obj-$(CONFIG_DRM_TEGRA) += tegra/
 obj-y			+= i2c/
+
+all:
+	make -C /lib/modules/$(KVER)/build M=`pwd` modules
+
+clean:
+	make -C /lib/modules/$(KVER)/build M=`pwd` clean
